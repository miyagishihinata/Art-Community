<%# „Ç§„É©„Çπ„ÉàË©≥Á¥∞ÁîªÈù¢ %>

  <div class="container">
    <%# „Éï„É©„ÉÉ„Ç∑„É•„É°„ÉÉ„Çª„Éº„Ç∏ %>
    <div class="mt-4 ml-4">
      <h6 class="text-muted font-weight-bold"><%= flash[:notice] %></h6>
    </div>
  </div>

  <div class="container">
    <div class="row">

      <div class="col-3  col-md-2"><%# ÊäïÁ®ø„É¶„Éº„Ç∂„Éº %>
        <div class="text-center">
          <%# „É¶„Éº„Ç∂„Éº„Ç¢„Ç§„Ç≥„É≥„ÄÄ%>
          <%= link_to user_path(@illustration.user.id) do %>
            <%= image_tag @illustration.user.get_profile_picture(100,100), class: "border border-2 mt-4" %>
          <% end %>
        </div>
        <%# „É¶„Éº„Ç∂„ÉºÂêç„ÄÄ%>
        <%= link_to user_path(@illustration.user.id) do %>
          <div class="user_name h4 text-center text-dark"><%= @illustration.user.user_name %></div>
        <% end %>
      </div>

      <div class="title col-7 col-md-5">
        <%# „Çø„Ç§„Éà„É´„ÄÄ%>
        <div class="form-group row mt-4">
         <h4 class="font-weight-bold"><%= @illustration.title %></h4>
        </div>

        <div class="form-group row">
          Ë™¨Êòé  : <%= @illustration.introduction %><br>
          ÊäïÁ®øÊó•: <%= @illustration.created_at.strftime('%Y/%m/%d') %><br>
        </div>

      </div>

      <div class="illustration_button col-5"><%# Á∑®ÈõÜ„Éú„Çø„É≥„ÄÄ%>
        <div class="form-group row">
          <% if @illustration.user == current_user %>
            <%= link_to '„Ç§„É©„Çπ„ÉàÁ∑®ÈõÜ', edit_illustration_path(@illustration.id), class: "btn btn-success col-md-4 offset-md-3 mt-4" %>
          <% end %>
        </div>
      </div>

    </div>
  </div>

  <hr color="silver">

  <div class="container"><%# „Ç§„É©„Çπ„Éà„ÄÄ%>
    <div class="row">
      <div class="px-3 mx-auto col-12 col-sm-10 col-lg-8 col-xl-6 mt-4">

        <div class="show_illustration">
          <div class="form-group row">
            <%= image_tag @illustration.image, class:"show_illustration" %>
          </div>
        </div>

      </div>
    </div>
  </div>

  <div class="container">
    <div class="row">

      <%# „ÅÑ„ÅÑ„Å≠ %>
      <div class="col-4 col-md-2">
        <div class="like h5 font-weight-bold text-muted mt-5">
          „ÅÑ„ÅÑ„Å≠
        </div>
      </div>

    <%# „ÅÑ„ÅÑ„Å≠„Éú„Çø„É≥ %>
    <% if @illustration.liked_by?(current_user, 0) %>
      <%= link_to illustration_likes_path(@illustration, like_stamp: 0), method: :delete do %>
        <%# „ÅÑ„ÅÑ„Å≠„ÅÇ„Çä %>
        <h4 class="mt-5 mr-4 text-muted">üòä <%= @illustration.likes.where(like_stamp: 0).count %></h4>
      <% end %>

    <% else %>
      <%= link_to illustration_likes_path(@illustration, like_stamp: 0), method: :post do %>
        <%# „ÅÑ„ÅÑ„Å≠„Å™„Åó %>
        <h5 class="mt-5 mr-4 text-muted">üòä <%= @illustration.likes.where(like_stamp: 0).count %></h5>
      <% end %>
    <% end %>

    <% if @illustration.liked_by?(current_user, 1) %>
      <%= link_to illustration_likes_path(@illustration, like_stamp: 1), method: :delete do %>
        <%# „ÅÑ„ÅÑ„Å≠„ÅÇ„Çä %>
        <h4 class="mt-5 mr-4 text-muted">üòç <%= @illustration.likes.where(like_stamp: 1).count %></h4>
      <% end %>

    <% else %>
      <%= link_to illustration_likes_path(@illustration, like_stamp: 1), method: :post do %>
        <%# „ÅÑ„ÅÑ„Å≠„Å™„Åó %>
        <h5 class="mt-5 mr-4 text-muted">üòç <%= @illustration.likes.where(like_stamp: 1).count %></h5>
      <% end %>
    <% end %>

    <% if @illustration.liked_by?(current_user, 2) %>
      <%= link_to illustration_likes_path(@illustration, like_stamp: 2), method: :delete do %>
        <%# „ÅÑ„ÅÑ„Å≠„ÅÇ„Çä %>
        <h4 class="mt-5 mr-4 text-muted">üò≠ <%= @illustration.likes.where(like_stamp: 2).count %></h4>
      <% end %>

    <% else %>
      <%= link_to illustration_likes_path(@illustration, like_stamp: 2), method: :post do %>
        <%# „ÅÑ„ÅÑ„Å≠„Å™„Åó %>
        <h5 class="mt-5 mr-4 text-muted">üò≠ <%= @illustration.likes.where(like_stamp: 2).count %></h5>
      <% end %>
    <% end %>

      <%# ÂÖ±Êúâ %>
      <div class="col-3 col-md-1">
        <div class="share h5 font-weight-bold text-muted mt-5">
          ÂÖ±Êúâ
        </div>
      </div>

      <div class="col-5 col-md-3 mt-5">
        <%# TwitterÂÖ±Êúâ„Éú„Çø„É≥ %>
        <%= link_to "https://twitter.com/share?url=#{request.url}", title: 'Twitter', target: '_blank' do %>
          <i class="h3 fa-brands fa-square-twitter mr-4 ml-4"></i>
        <% end %>

        <%# InstagramÂÖ±Êúâ„Éú„Çø„É≥ %>
        <%= link_to "https://instagram.com/share?url=#{request.url}", title: 'Instagram', target: '_blank' do %>
          <i class="h3 fa-brands fa-instagram"></i>
        <% end %>
      </div>

    </div>
  </div>


  <div class="container"><%# „Ç≥„É°„É≥„Éà %>
    <div class="row">
      <div class="col-4 col-md-2">
        <h5 class="comment font-weight-bold text-muted mt-5">
          „Ç≥„É°„É≥„Éà
        </h5>
      </div>

      <div class="col-2">
        <h6 class="mt-5 text-muted">
          <%= @illustration.comments.count %> ‰ª∂
        </h6>
      </div>

    </div>
  </div>

  <%# „Ç≥„É°„É≥„ÉàÈÄÅ‰ø°„Éï„Ç©„Éº„É† %>
  <%= form_with model: [@illustration, @comment] do |f| %>
    <div class="container">
      <div class="row">

        <div class="col-12 col-md-7">
          <%= f.text_area :post_comment, class: "col-md-11 offset-md-1 mt-3 form-control", placeholder: "„Ç≥„É°„É≥„ÉàË®òÂÖ•" %>
        </div>

        <div class="col-5">
          <%= f.submit "ÈÄÅ‰ø°„Åô„Çã", class: "btn btn-success col-md-3 mt-4 mb-5" %>
        </div>

      </div>
    </div>
  <% end %>

  <%# Ë¶™„Ç≥„É°„É≥„Éà %>
  <% @comments.each_with_index do |comment| %>
    <div class="container">
      <div class="row">

        <div class="col-3 col-md-2 ml-3">
          <div class="text-center">
            <%# „É¶„Éº„Ç∂„Éº„Ç¢„Ç§„Ç≥„É≥„ÄÄ%>
            <%= link_to user_path(comment.user.id) do %>
              <%= image_tag comment.user.get_profile_picture(70,70), class: "border border-2 mt-3" %>
            <% end %>
          </div>
            <%# „É¶„Éº„Ç∂„ÉºÂêç„ÄÄ%>
            <%= link_to user_path(comment.user.id) do %>
              <div class="comment_user h5 text-center text-dark mb-3"><%= comment.user.user_name %></div>
            <% end %>
        </div>

        <div class="col-5">
          <%# „Ç≥„É°„É≥„Éà %>
          <div class="mt-3">
            <%= comment.post_comment %><br>
          </div>
          <%# „Ç≥„É°„É≥„Éà‰ΩúÊàêÊó•ÊôÇ„ÄÄ%>
          <h6 class="text-secondary mt-3">
            (<%= comment.created_at.strftime('%Y/%m/%d') %>)<br>
          </h6>
        </div>

        <div class="col-4">
          <%# ÂâäÈô§„Éú„Çø„É≥„ÄÄ%>
          <% if comment.user == current_user %><%# „Ç≥„É°„É≥„Éà„Åó„Åü„ÇÇ„ÅÆ„Åå„É≠„Ç∞„Ç§„É≥„É¶„Éº„Ç∂„Éº„ÅÆ„ÇÇ„ÅÆ„Åß„ÅÇ„Çå„Å∞ÂâäÈô§„Éú„Çø„É≥Ë°®Á§∫ %>
            <%= link_to "„Ç≥„É°„É≥„ÉàÂâäÈô§", illustration_comment_path(comment.illustration, comment), method: :delete, class: "btn btn-outline-secondary col-md-5 mt-3 mb-3" %>
          <% end %>
        </div>

      </div>
    </div>


  <%# Ë¶™„Ç≥„É°„É≥„Éà„Å∏„ÅÆËøî‰ø° %>
  <div class="container">

    <%# „Ç≥„É°„É≥„ÉàËøî‰ø°ÂèéÁ¥ç„Éú„Çø„É≥ %>
    <div class ="reply">
      <a id="btn-txt" class="btn btn-primary offset-md-2 col-md-5 mb-3 reply-btn">üí¨„Ç≥„É°„É≥„ÉàËøî‰ø°</a>
        <ul class="items"  style="display: none;">

            <%# Ë¶™„Ç≥„É°„É≥„Éà„Å∏„ÅÆËøî‰ø° %>
            <%= form_with(model:[@illustration,@comment]) do |f| %>
              <div class="container">
                <div class="row">

                  <div class="form-group col-12 col-md-6">
                    <%= f.text_area :post_comment, class: "col-md-11 offset-md-4 mt-3 form-control", placeholder: "Ëøî‰ø°„Ç≥„É°„É≥„ÉàË®òÂÖ•" %>
                  </div>

                  <%= f.hidden_field :illustration_id, value: @illustration.id %>
                  <%= f.hidden_field :parent_id, value: comment.id%>

                  <%# Ëøî‰ø°„Éú„Çø„É≥ %>
                  <div class="col-5">
                    <%= f.submit "Ëøî‰ø°„Åô„Çã", class: "btn btn-primary col-md-3 offset-md-4 mt-4 mb-5" %>
                  </div>

                </div>
              </div>
            <% end %>


  <%# Ëøî‰ø°„Ç≥„É°„É≥„Éà %>
  <% @replys = Comment.where(parent_id: comment.id) %>
    <% @replys.each do |reply| %><%# „Ç≥„É°„É≥„ÉàË°®Á§∫ %>
    <div class="container mr-5">
      <div class="row">

        <div class="col-3 col-md-2 ml-3">
          <div class="text-center">
            <%# „É¶„Éº„Ç∂„Éº„Ç¢„Ç§„Ç≥„É≥„ÄÄ%>
            <%= link_to user_path(reply.user.id) do %>
              <%= image_tag reply.user.get_profile_picture(70,70), class: "border border-2 mt-3" %>
            <% end %>
          </div>
            <%# „É¶„Éº„Ç∂„ÉºÂêç„ÄÄ%>
            <%= link_to user_path(reply.user.id) do %>
              <div class="comment_user h5 text-center text-dark mb-3"><%= reply.user.user_name %></div>
            <% end %>
        </div>

        <div class="col-8 col-md-5">
          <div class="text-primary">
            <% if reply.parent_id %>
              <%= reply.parent.user.user_name%> „Åï„Çì„Å∏„ÅÆ„Ç≥„É°„É≥„Éà<br>
            <% end %>
          </div>
          <%# „Ç≥„É°„É≥„Éà %>
          <div class="mt-3">
            <%= reply.post_comment %><br>
          </div>
          <%# „Ç≥„É°„É≥„Éà‰ΩúÊàêÊó•ÊôÇ„ÄÄ%>
          <h6 class="text-secondary mt-3">
            (<%= reply.created_at.strftime('%Y/%m/%d') %>)<br>
          </h6>
        </div>

        <div class="col-4">
          <%# ÂâäÈô§„Éú„Çø„É≥„ÄÄ%>
          <% if reply.user == current_user %><%# „Ç≥„É°„É≥„Éà„Åó„Åü„ÇÇ„ÅÆ„Åå„É≠„Ç∞„Ç§„É≥„É¶„Éº„Ç∂„Éº„ÅÆ„ÇÇ„ÅÆ„Åß„ÅÇ„Çå„Å∞ÂâäÈô§„Éú„Çø„É≥Ë°®Á§∫ %>
            <%= link_to "„Ç≥„É°„É≥„ÉàÂâäÈô§", illustration_comment_path(reply.illustration, reply), method: :delete, class: "btn btn-outline-secondary col-md-5 ml-4 mt-3 mb-3" %>
          <% end %>
        </div>

      </div>
    </div>

    <% end %>
    <%# „Ç≥„É°„É≥„ÉàËøî‰ø°ÂèéÁ¥ç„Éú„Çø„É≥ %>
        </ul>
    </div>
  </div>

    <hr>
  <% end %>

